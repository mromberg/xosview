#
# Top level Makefile Template for xosview.
# 
include Makefile.config

OBJS = \
llist.o \
Host.o \
xwin.o \
Xrm.o \
defaultstring.o \
meter.o \
fieldmeter.o \
fieldmeterdecay.o \
bitmeter.o \
xosview.o \
main.o

CFILES := $(OBJS:.o=.cc)
DEPFILES := $(OBJS:%=.%.d)

INSTALL            = @INSTALL@
INSTALL_PROGRAM    = @INSTALL_PROGRAM@
INSTALL_DATA       = @INSTALL_DATA@

#-----------------------------------------------------------------------

all : meters xosview

defaultstring.cc: Xdefaults defresources.awk
	@AWK@ -f defresources.awk Xdefaults > defaultstring.cc

meters :
	$(MAKE) -C @host_os@

@host_os@/libmeter.a : meters

clean :
	$(MAKE) -C @host_os@ clean
	$(MAKE) -C config clean
	rm -f xosview $(OBJS) $(DEPFILES) *~ defaultstring.cc

xosview: $(OBJS) @host_os@/libmeter.a
	$(CXX) $(LFLAGS) -o xosview $(OBJS) $(LIBS)

ifeq (@host_os@,linux)
install: 
	install -c -s -m 4755  xosview /usr/bin/X11
	install -c Xdefaults /usr/lib/X11/app-defaults/XOsview
endif

ifeq (@host_os@,netbsd)
install: xosview
	install -c -s -g kmem -m 02555 xosview /usr/bin/X11
	install -c Xdefaults /usr/lib/X11/app-defaults/XOsview
endif

install-man:
	install -c xosview.1 /usr/X11/man/man1

distrib: clean clean_config config_ # concatdepend
	cd ..;tar cf `basename $(PWD)`.tar `basename $(PWD)`; \
        gzip -9 `basename $(PWD)`.tar

config_:
	$(MAKE) -C config

clean_config:
	rm -f Makefile Makefile.config @host_os@/Makefile \
           config.cache config.log config.status configure

@AUTODEPEND@
